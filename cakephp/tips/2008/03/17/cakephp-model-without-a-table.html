<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>CakePHP ; Model without table</title>
        <meta name="viewport" content="initial-scale=1.0">
        <link href='/assets/global-4f95d28fa671039d795aecbacd54a16d.css' rel='stylesheet' type='text/css' />

    </head>
    <body>
      <div class="container">
        <header>
          <h1>Jean-Philippe Doyle (j15e)</h1>
          <h2>Developer, homebrewer & more</h2>
          <nav>
            <a href="/">articles</a></h1>
            <a class="extra" target="_blank" href="http://github.com/j15e/">@github</a>
            <a class="extra" target="_blank" href="http://twitter.com/j15e/">@twitter</a>
          </nav>
        </header>

            <h2>CakePHP ; Model without table</h2>
<p class="meta">17 Mar 2008</p>

<div id="post" class="hyphenate text" lang="en">
<p>Why do this? To validate data on a form that won't be stored in a database and still use both validation component and form helper.</p>

<p>Exemple : you want to create a form that allow users to share by email any article on your website.</p>

<h3>1 - Model</h3>


<pre><code>class ArticleEmail extends AppModel {

    // Specify to not use a table
    var $useTable = false;

    // Specify your schema (instead of a table)
    var $_schema = array(
        'to_email' =&gt; array(
            'type' =&gt; 'string',
            'length' =&gt; 100),
        'message' =&gt; array(
            'type' =&gt; 'text'),
        'from_name' =&gt; array(
            'type' =&gt; 'string',
            'length' =&gt; 100),
        'from_email' =&gt; array(
            'type' =&gt; 'string',
            'length' =&gt; 100),
    );

    // Usual validations
    var $validate = array(
        'to_email' =&gt; array(
            'rule'=&gt; VALID_EMAIL,
            'message'=&gt; 'Email must be valid'
            ),
        'message' =&gt; VALID_NOT_EMPTY,
        'from_name' =&gt; VALID_NOT_EMPTY,
        'from_email' =&gt; array(
            'rule'=&gt; VALID_EMAIL,
            'message'=&gt; 'Email must be valid'
            ),
    );
}
</code></pre>

<h3>2 - View</h3>


<p>Same thing as if it  was a database model (that's what you want).</p>

<h3>3 - Controller</h3>


<p>Specify to use the tableless model if you are using your model inside an other controller (here I am using ArticleEmail in my Article controller for the form that sends an article link to a user friend).</p>

<p>When you add models to a controller $uses, include the original model too :</p>

<pre><code>var $uses = array('Article','ArticleEmail');
</code></pre>

<p>Instead of the usual "create/update" code :</p>

<pre><code>$this-&gt;Article-&gt;create();
if ($this-&gt;Article-&gt;save($this-&gt;data)) {
</code></pre>

<p>You must use this one that won't try to save it to the database when all fields validates :</p>

<pre><code>$this-&gt;ArticleEmail-&gt;create();
$this-&gt;ArticleEmail-&gt;data = $this-&gt;data;
if($this-&gt;ArticleEmail-&gt;validates()) {
</code></pre>

<p>Notice that you must set the data before using validates() as opposite to save() method.</p>

<p>You are done. Everything else will be done automatically as usual.</p>

</div>


        <footer>
          <a target="_blank" href="https://github.com/j15e/j15e.github.io">View source (⌥⌘U)</a>
        </footer>
      </div>
    </body>
</html>
